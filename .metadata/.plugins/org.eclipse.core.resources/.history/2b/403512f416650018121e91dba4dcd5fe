package infovis.scatterplot;

import java.awt.event.MouseEvent;
import infovis.debug.Debug;
import java.awt.event.MouseListener;
import java.awt.event.MouseMotionListener;
import java.awt.geom.Point2D;
import java.awt.geom.Rectangle2D;

import com.sun.org.apache.xml.internal.resolver.helpers.Debug;

public class MouseController implements MouseListener, MouseMotionListener {
	private Model model = null;
	private View view = null;
	private double startingX = 0;
	private double startingY = 0;
	private Rectangle2D selectedCell;

	public void mouseClicked(MouseEvent arg0) {
	}

	public void mouseEntered(MouseEvent arg0) {
	}

	public void mouseExited(MouseEvent arg0) {
	}

	public void mousePressed(MouseEvent e) {
		startingX = e.getX();
		startingY = e.getY();
		view.getMarkerRectangle().setRect(startingX, startingY, 0, 0);

		for (Rectangle2D cell : view.getCellList()) {
			if (cell.contains(new Point2D.Double(startingX, startingY))) {
				selectedCell = cell;
				break;
			}
		}
	}

	public void mouseReleased(MouseEvent arg0) {
		view.getMarkerRectangle().setRect(0, 0, 0, 0);
		view.repaint();
	}

	public void mouseDragged(MouseEvent e) {
		int x = e.getX();
		int y = e.getY();

		Rectangle2D marker = view.getMarkerRectangle();
		double markerX = startingX;
		double markerY = startingY;
		double width = Math.abs(x - startingX);
		double height = Math.abs(y - startingY);
		double maxWidth = 0;
		double maxHeight = 0;

		if (x > startingX) {
			// draw to the right
			maxWidth = selectedCell.getX() + selectedCell.getWidth() - startingX;
		} else {
			// draw to the left
			markerX = x;
			maxWidth = startingX - selectedCell.getX();
		}

		if (y > startingY) {
			// draw downwards
			maxHeight = selectedCell.getY() + selectedCell.getHeight() - startingY;
		} else {
			// draw upwards
			markerY = y;
			maxHeight = startingY - selectedCell.getY();
		}

		// keep marker within cell
		if (width > maxWidth) {
			width = maxWidth;
		}

		if (height > maxHeight) {
			height = maxHeight;
		}

		marker.setRect(markerX, markerY, width, height);
		view.repaint();
		Debug.println(maxWidth, maxHeight);
	}

	public void mouseMoved(MouseEvent arg0) {
	}

	public void setModel(Model model) {
		this.model = model;
	}

	public void setView(View view) {
		this.view = view;
	}
}
